<?php
// Include configuration for the database connection
include('config.php');
session_start();

// Ensure the user is logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$userId = $_SESSION['user_id'];

// Prepare and execute the query to fetch user data
$query = 'SELECT username, email, credit, usertype, total_cc, tg_id, name, reg_data, secretkey FROM users WHERE id = ?';
$stmt = $conn->prepare($query);

if (!$stmt) {
    die("Prepare failed: " . $conn->error);
}

$stmt->bind_param("i", $userId);
$stmt->execute();
$result = $stmt->get_result();

// Check if the result is valid and store user data in variables
if ($result && $result->num_rows > 0) {
    $row = $result->fetch_assoc();
    $username = $row['username'];
    $email = $row['email'];
    $credit = $row['credit'];
    $usertype = $row['usertype'];
    $total_cc = $row['total_cc'];
    $tg_id = $row['tg_id'];
    $name = $row['name'];
    $reg_date = $row['reg_data'];
    $secretkey = $row['secretkey'];
} else {
    echo "No user found with that ID or query failed.";
}

$stmt->close();

// If the form is submitted, process the form data and update the user
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    // Sanitize and retrieve input values
    $username = $conn->real_escape_string($_POST['username']);
    $email = $conn->real_escape_string($_POST['email']);
    $total_cc = intval($_POST['total_cc']);
    $tg_id = $conn->real_escape_string($_POST['tg_id']);
    $name = $conn->real_escape_string($_POST['name']);
    $secretkey = $conn->real_escape_string($_POST['secretkey']);

    // Update query to update user data in the database
    $query = "UPDATE users SET 
                username = ?, 
                email = ?, 
                total_cc = ?, 
                tg_id = ?, 
                name = ?, 
                secretkey = ? 
              WHERE id = ?";

    // Prepare and bind
    $stmt = $conn->prepare($query);
    $stmt->bind_param("ssisssi", $username, $email, $total_cc, $tg_id, $name, $secretkey, $userId);
    
    // Execute the query and check for success
    if ($stmt->execute()) {
        echo "User information updated successfully.";
        header("Location: profile.php"); // Redirect to profile page or any other page
        exit();
    } else {
        echo "Error updating user information: " . $conn->error;
    }

    $stmt->close();
}

$conn->close();
?>


<!DOCTYPE html>





























<!-- =========================================================
* Vuexy - Bootstrap Admin Template | v9.0.0
==============================================================

* Product Page: https://1.envato.market/vuexy_admin
* Created by: Pixinvent
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright Pixinvent (https://pixinvent.com)

=========================================================
 -->
<!-- beautify ignore:start -->


<html lang="en" class="dark-style layout-navbar-fixed layout-menu-fixed layout-compact " dir="ltr" data-theme="theme-default" data-assets-path="./assets/" data-template="vertical-menu-template-dark">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>User Profile - Profile | Vuexy - Bootstrap Admin Template</title>

    
    <meta name="description" content="Start your development with a Dashboard for Bootstrap 5" />
    <meta name="keywords" content="dashboard, bootstrap 5 dashboard, bootstrap 5 design, bootstrap 5">
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://1.envato.market/vuexy_admin">
    
    
    <!-- ? PROD Only: Google Tag Manager (Default ThemeSelection: GTM-5DDHKGP, PixInvent: GTM-5J3LMKC) -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5J3LMKC');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="./assets/vendor/fonts/fontawesome.css" />
    <link rel="stylesheet" href="./assets/vendor/fonts/tabler-icons.css"/>
    <link rel="stylesheet" href="./assets/vendor/fonts/flag-icons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="./assets/vendor/css/rtl/core-dark.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="./assets/vendor/css/rtl/theme-default-dark.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="./assets/css/demo.css" />
    
    <!-- Vendors CSS -->
    <link rel="stylesheet" href="./assets/vendor/libs/node-waves/node-waves.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="./assets/vendor/libs/typeahead-js/typeahead.css" /> 
    <link rel="stylesheet" href="./assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css">
<link rel="stylesheet" href="./assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css">
<link rel="stylesheet" href="./assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css">

    <!-- Page CSS -->
    <link rel="stylesheet" href="./assets/vendor/css/pages/page-profile.css" />

    <!-- Helpers -->
    <script src="./assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
    <script src="./assets/vendor/js/template-customizer.js"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="./assets/js/config.js"></script>
    
</head>

<body>

  
  <!-- ?PROD Only: Google Tag Manager (noscript) (Default ThemeSelection: GTM-5DDHKGP, PixInvent: GTM-5J3LMKC) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DDHKGP" height="0" width="0" style="display: none; visibility: hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar  ">
  <div class="layout-container">

    
    




<!-- Menu -->

<?php include './headers/sidebar.php'; ?>
<!-- / Menu -->

    

    <!-- Layout container -->
    <div class="layout-page">
      
      



<!-- Navbar -->

<?php include './headers/nav.php'; ?>
<!-- / Navbar -->

      

      <!-- Content wrapper -->
      <div class="content-wrapper">

        <!-- Content -->
        
          <div class="container-xxl flex-grow-1 container-p-y">
            
            
<h4 class="py-3 mb-4">
  <span class="text-muted fw-light">User Profile /</span> Profile
</h4>






<div class="row">
  <div class="col-xl-4 col-lg-5 col-md-5">
    <!-- About User -->
    <div class="card mb-4">
      <div class="card-body">
        <small class="card-text text-uppercase">User Information</small>
        <ul class="list-unstyled mb-4 mt-3">
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-user text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Username:</span> 
            <span><?php echo htmlspecialchars($username); ?></span>
          </li>
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-crown text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Role:</span>
            <span><?php echo htmlspecialchars($usertype == '1' ? 'User' : 'Admin'); ?></span>
          </li>
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-phone-call text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Telegram ID:</span> 
            <span><?php echo htmlspecialchars($tg_id); ?></span>
          </li>
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-calendar text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Registration Date:</span> 
            <span><?php echo htmlspecialchars($reg_date); ?></span>
          </li>
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-key text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Secret Key:</span> 
            <span><?php echo htmlspecialchars($secretkey); ?></span>
          </li>
          <li class="d-flex align-items-center mb-3">
            <i class="ti ti-credit-card text-heading"></i>
            <span class="fw-medium mx-2 text-heading">Credits:</span> 
            <span><?php echo htmlspecialchars($credit); ?></span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
    <!--/ About User -->

<!-- HTML Form -->
<div class="col-md-6">
  <div class="card mb-4">
    <h5 class="card-header">Update Your Information</h5>
    <div class="card-body">
      <form  method="POST">
        <!-- Username -->
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          <input type="text" name="username" class="form-control" id="username" value="<?php echo htmlspecialchars($username); ?>" required />
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label for="email" class="form-label">Email address</label>
          <input type="email" name="email" class="form-control" id="email" value="<?php echo htmlspecialchars($email); ?>" required />
        </div>

        <!-- Credit (Read-only) -->
        <div class="mb-3">
          <label for="credit" class="form-label">Credit (Read-only)</label>
          <input type="text" class="form-control" id="credit" value="<?php echo htmlspecialchars($credit); ?>" readonly />
        </div>

        <!-- User Type (Read-only) -->
        <div class="mb-3">
          <label for="usertype" class="form-label">User Type (Read-only)</label>
          <input type="text" class="form-control" id="usertype" value="<?php echo htmlspecialchars($usertype); ?>" readonly />
        </div>

        <!-- Total CC -->
        <div class="mb-3">
          <label for="total_cc" class="form-label">Total CC</label>
          <input type="number" name="total_cc" class="form-control" id="total_cc" value="<?php echo htmlspecialchars($total_cc); ?>" readonly />
        </div>

        <!-- Telegram ID -->
        <div class="mb-3">
          <label for="tg_id" class="form-label">Telegram ID</label>
          <input type="text" name="tg_id" class="form-control" id="tg_id" value="<?php echo htmlspecialchars($tg_id); ?>" />
        </div>

        <!-- Name -->
        <div class="mb-3">
          <label for="name" class="form-label">Name</label>
          <input type="text" name="name" class="form-control" id="name" value="<?php echo htmlspecialchars($name); ?>" />
        </div>

        <!-- Registration Date (Read-only) -->
        <div class="mb-3">
          <label for="reg_date" class="form-label">Registration Date</label>
          <input type="text" class="form-control" id="reg_date" value="<?php echo htmlspecialchars($reg_date); ?>" readonly />
        </div>

        <!-- Secret Key (Read-only) and Generate Button -->
        <div class="mb-3">
          <label for="secretkey" class="form-label">Secret Key (Read-only)</label>
          <input type="text" name="secretkey" class="form-control" id="secretkey" value="<?php echo htmlspecialchars($secretkey); ?>" readonly />
          <button type="button" class="btn btn-secondary mt-2" onclick="generateSecretKey()">Generate New Secret Key</button>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">Update Information</button>
      </form>
    </div>
  </div>
</div>




          <!-- / Content -->

          
          

<!-- Footer -->
<?php include './headers/footer.php'; ?>
<!-- / Footer -->

          

  

  

  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  
  <script src="./assets/vendor/libs/jquery/jquery.js"></script>
  <script src="./assets/vendor/libs/popper/popper.js"></script>
  <script src="./assets/vendor/js/bootstrap.js"></script>
  <script src="./assets/vendor/libs/node-waves/node-waves.js"></script>
  <script src="./assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="./assets/vendor/libs/hammer/hammer.js"></script>
  <script src="./assets/vendor/libs/i18n/i18n.js"></script>
  <script src="./assets/vendor/libs/typeahead-js/typeahead.js"></script>
   <script src="./assets/vendor/js/menu.js"></script>
  
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="./assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>

  <!-- Main JS -->
  <script src="./assets/js/main.js"></script>
  

  <!-- Page JS -->
  <script src="./assets/js/pages-profile.js"></script>
  
  
<script>
// JavaScript function to generate a new secret key
function generateSecretKey() {
    // Generate a random secret key with the format "blueeye_" followed by 20+ random alphanumeric characters
    let randomString = '';
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    const length = 20;

    for (let i = 0; i < length; i++) {
        randomString += characters.charAt(Math.floor(Math.random() * characters.length));
    }

    let secretKey = 'blueeye_' + randomString;
    document.getElementById('secretkey').value = secretKey;
}
</script>

</body>

</html>

<!-- beautify ignore:end -->

